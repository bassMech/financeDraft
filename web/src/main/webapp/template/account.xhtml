<ui:composition template="/template/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<title>#{tags['accounts']}</title>
		<f:metadata>
			<f:event type="preRenderView" listener="#{accountView.checkLanguageChange()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<h:outputStylesheet name="account.css" library="style" />
		<div class="grid">
			<div class="col-4 col-offset-4 flex justify-content-evenly">
				<div>
					<div>
						<p:tag value="#{tags['month']}" />
					</div>
					<div>
						<p:commandButton icon="pi pi-chevron-left" action="#{accountView.onPreviousMonthClick}" process="@this" update="monthSelect" />
						<p:selectOneMenu id="monthSelect" value="#{accountView.selectedMonth}" style="width:150px">
							<p:ajax listener="#{accountView.onMonthChanged}" />
							<f:selectItems value="#{accountView.selectableMonths.entrySet()}" var="month" itemLabel="#{month.value}" itemValue="#{month.key}" />
						</p:selectOneMenu>
						<p:commandButton icon="pi pi-chevron-right" action="#{accountView.onNextMonthClick}" process="@this" update="monthSelect" />
					</div>
				</div>
				<div>
					<div>
						<p:tag value="#{tags['year']}" />
					</div>
					<div>
						<p:selectOneMenu id="yearSelect" value="#{accountView.selectedYear}" style="width:150px">
							<p:ajax listener="#{accountView.onYearChanged}" />
							<f:selectItems value="#{accountView.selectableYears}" var="year" itemLabel="#{year}" itemValue="#{year}" />
						</p:selectOneMenu>
					</div>
				</div>
			</div>
			<div class="col-4">
				<div class="flex justify-content-end">
					<div>
						<div>
							<p:tag value="#{tags['account']}" />
						</div>
						<div>
							<p:selectOneMenu id="accountSelect" value="#{accountView.selectedAccount}" style="width:150px">
								<p:ajax listener="#{accountView.onAccountChange}" />
								<f:selectItems value="#{accountView.selectableAccounts}" var="account" itemLabel="#{account.title}" itemValue="#{account}" />
							</p:selectOneMenu>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="card flex justify-content-start flex-wrap">
			<p:dataTable id="transactions" var="transaction" value="#{accountView.currentAccountingMonth.transactions}" rowKey="#{transaction.id}"
				rowStyleClass="#{accountView.getTransactionRowColorString(transaction)}" allowUnsorting="true" sortMode="single" size="small">

				<f:facet name="header">
					<div class="flex justify-content-end">
						<div>
							<div class="flex justify-content-end transaction-header-side-padding bold">
								<h:outputText value="#{tags['transactions']}: " />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								<h:outputText value="#{tags['executed']}: " />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								<h:outputText value="#{tags['expected']}: " />
							</div>
						</div>
						<div>
							<div>
								<p:spacer width="1" height="1" />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								&#9;
								<h:outputText value="#{accountView.currentAccountingMonth.transactionCountExecuted}" />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								<h:outputText value="#{accountView.currentAccountingMonth.transactionCountExpected}" />
							</div>
						</div>

						<div>
							<div class="flex justify-content-end transaction-header-side-padding bold">
								<h:outputText value="#{tags['sum']}: " />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								<h:outputText value="#{tags['current']}: " />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								<h:outputText value="#{tags['closing']}: " />
							</div>
						</div>
						<div>
							<div>
								<p:spacer width="1" height="1" />
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								&#9;
								<h:outputText value="#{accountView.currentAccountingMonth.getCurrentValue()}">
									<f:convertNumber currencySymbol="#{accountView.settingService.dbCurrency.symbol}" type="currency" />
								</h:outputText>
							</div>
							<div class="flex justify-content-end transaction-header-side-padding">
								<h:outputText value="#{accountView.currentAccountingMonth.getClosingValue()}">
									<f:convertNumber currencySymbol="#{accountView.settingService.dbCurrency.symbol}" type="currency" />
								</h:outputText>
							</div>
						</div>

					</div>
				</f:facet>
				<p:column style="width:2rem">
					<p:rowToggler />
				</p:column>
				<p:column headerText="#{tags['title']}" sortBy="#{transaction.title}">
					<h:outputText value="#{transaction.title}" />
				</p:column>
				<p:column headerText="#{tags['value']}" sortBy="#{transaction.value}">
					<h:outputText value="#{transaction.value}">
						<f:convertNumber currencySymbol="#{accountView.settingService.dbCurrency.symbol}" type="currency" />
					</h:outputText>
				</p:column>>
				<p:column headerText="#{tags['date']}" sortBy="#{transaction.expectedDay}" sortOrder="asc">
					<h:outputText value="#{transaction.expectedDay}" />
					<i class="#{transaction.executedAt == null ? 'pi pi-question-circle': 'pi pi-check-circle'}" />
				</p:column>

				<p:rowExpansion>
					<div class="product">
						<div class="product-list-item">
							<div class="product-list-detail">
								<div class="product-description">#{transaction.description}</div>
							</div>
						</div>
					</div>
				</p:rowExpansion>

			</p:dataTable>

		</div>
	</ui:define>
</ui:composition>


